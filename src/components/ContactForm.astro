---
import ModernButton from './ui/ModernButton.astro';
import Card from './ui/Card.astro';
import Icon from './ui/Icon.astro';
import Animate from './ui/Animate.astro';
import { withBasePath } from '../utils/helpers';

interface Props {
  title?: string;
  subtitle?: string;
  showContactInfo?: boolean;
}

const {
  title = 'Get In Touch',
  subtitle = "Ready to transform your business? Let's discuss your needs.",
  showContactInfo = true,
} = Astro.props;
---

<section class="contact-section section">
  <div class="container">
    <div class="section-header">
      <Animate animation="fade-in" delay="md">
        <h2 class="heading-2 text-center">{title}</h2>
        <p class="text-large text-muted mx-auto max-w-2xl text-center">
          {subtitle}
        </p>
      </Animate>
    </div>

    <div class="contact-grid grid grid-cols-1 gap-12 lg:grid-cols-2">
      <!-- Contact Form -->
      <Animate animation="slide-right" delay="lg">
        <Card className="h-full">
          <form id="contact-form" class="contact-form" data-keyboard-aware>
            <div class="form-grid grid grid-cols-1 gap-6 md:grid-cols-2">
              <div class="form-group">
                <label for="firstName" class="form-label">First Name *</label>
                <input
                  id="firstName"
                  type="text"
                  name="firstName"
                  class="form-input"
                  required
                  inputmode="text"
                  autocapitalize="words"
                  enterkeyhint="next"
                  autocomplete="given-name"
                />
                <div class="form-error hidden" role="alert" aria-live="polite">
                </div>
              </div>

              <div class="form-group">
                <label for="lastName" class="form-label">Last Name *</label>
                <input
                  id="lastName"
                  type="text"
                  name="lastName"
                  class="form-input"
                  required
                  inputmode="text"
                  autocapitalize="words"
                  enterkeyhint="next"
                  autocomplete="family-name"
                />
                <div class="form-error hidden" role="alert" aria-live="polite">
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="email" class="form-label">Email Address *</label>
              <input
                id="email"
                type="email"
                name="email"
                class="form-input"
                required
                inputmode="email"
                autocapitalize="none"
                spellcheck="false"
                enterkeyhint="next"
                autocomplete="email"
              />
              <div class="form-error hidden" role="alert" aria-live="polite">
              </div>
            </div>

            <div class="form-group">
              <label for="company" class="form-label">Company</label>
              <input
                id="company"
                type="text"
                name="company"
                class="form-input"
                inputmode="text"
                autocapitalize="words"
                enterkeyhint="next"
                autocomplete="organization"
              />
            </div>

            <div class="form-group">
              <label for="phone" class="form-label">Phone</label>
              <input
                id="phone"
                type="tel"
                name="phone"
                class="form-input"
                inputmode="tel"
                autocapitalize="none"
                enterkeyhint="next"
                autocomplete="tel"
              />
              <div class="form-error hidden" role="alert" aria-live="polite">
              </div>
            </div>

            <div class="form-group">
              <label for="subject" class="form-label">Subject *</label>
              <select id="subject" name="subject" class="form-select" required>
                <option value="">Please select a topic</option>
                <option value="general">General Inquiry</option>
                <option value="consulting">Consulting Services</option>
                <option value="technology">Technology Solutions</option>
                <option value="partnership">Partnership Opportunities</option>
                <option value="support">Support Request</option>
                <option value="other">Other</option>
              </select>
              <div class="form-error hidden" role="alert" aria-live="polite">
              </div>
            </div>

            <div class="form-group">
              <label for="budget" class="form-label">Project Budget</label>
              <select id="budget" name="budget" class="form-select">
                <option value="">Select budget range</option>
                <option value="under-25k">Under $25,000</option>
                <option value="25k-50k">$25,000 - $50,000</option>
                <option value="50k-100k">$50,000 - $100,000</option>
                <option value="100k-250k">$100,000 - $250,000</option>
                <option value="250k-500k">$250,000 - $500,000</option>
                <option value="over-500k">Over $500,000</option>
              </select>
            </div>

            <div class="form-group">
              <label for="timeline" class="form-label">Project Timeline</label>
              <select id="timeline" name="timeline" class="form-select">
                <option value="">Select timeline</option>
                <option value="asap">ASAP</option>
                <option value="1-3months">1-3 months</option>
                <option value="3-6months">3-6 months</option>
                <option value="6-12months">6-12 months</option>
                <option value="over-12months">Over 12 months</option>
                <option value="exploring">Just exploring</option>
              </select>
            </div>

            <div class="form-group">
              <label for="message" class="form-label">Message *</label>
              <textarea
                id="message"
                name="message"
                class="form-textarea"
                required
                rows="5"
                enterkeyhint="send"
                placeholder="Tell us about your project, goals, and how we can help..."
              ></textarea>
              <div class="form-error hidden" role="alert" aria-live="polite">
              </div>
            </div>

            <div class="form-group">
              <div class="flex items-start gap-3">
                <input
                  id="newsletter"
                  type="checkbox"
                  name="newsletter"
                  class="form-checkbox mt-1"
                />
                <label for="newsletter" class="text-small text-muted">
                  I'd like to receive updates about new services and industry
                  insights
                </label>
              </div>
            </div>

            <div class="form-group">
              <div class="flex items-start gap-3">
                <input
                  id="terms"
                  type="checkbox"
                  name="terms"
                  class="form-checkbox mt-1"
                  required
                />
                <label for="terms" class="text-small text-muted">
                  I agree to the <a href={withBasePath('privacy/')} class="link"
                    >Privacy Policy</a
                  > and <a href={withBasePath('terms/')} class="link"
                    >Terms of Service</a
                  > *
                </label>
              </div>
              <div class="form-error hidden"></div>
            </div>

            <div class="form-actions">
              <ModernButton
                type="submit"
                variant="primary"
                size="lg"
                className="w-full"
              >
                <span class="inline-flex items-center gap-2">
                  <span>Send Message</span>
                  <svg
                    class="h-4 w-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                  </svg>
                </span>
              </ModernButton>

              <div
                class="form-status mt-4 hidden rounded-md p-4"
                role="status"
                aria-live="polite"
              >
              </div>
            </div>
          </form>
        </Card>
      </Animate>

      <!-- Contact Information -->
      {
        showContactInfo && (
          <Animate animation="slide-left" delay="lg">
            <div class="contact-info space-y-8">
              <Card>
                <div class="contact-item">
                  <div class="contact-icon">
                    <Icon name="mapPin" size="lg" color="current" />
                  </div>
                  <div class="contact-details">
                    <h4 class="heading-6">Visit Our Office</h4>
                    <p class="text-muted">
                      123 Business District
                      <br />
                      Suite 500
                      <br />
                      New York, NY 10001
                    </p>
                  </div>
                </div>
              </Card>

              <Card>
                <div class="contact-item">
                  <div class="contact-icon">
                    <Icon name="phone" size="lg" color="current" />
                  </div>
                  <div class="contact-details">
                    <h4 class="heading-6">Call Us</h4>
                    <p class="text-muted">
                      Main:{' '}
                      <>
                        <a href="tel:+1-555-123-4567" class="link">
                          +1 (555) 123-4567
                        </a>
                        <br />
                      </>
                      Support:{' '}
                      <a href="tel:+1-555-123-4568" class="link">
                        +1 (555) 123-4568
                      </a>
                    </p>
                  </div>
                </div>
              </Card>

              <Card>
                <div class="contact-item">
                  <div class="contact-icon">
                    <Icon name="mail" size="lg" color="current" />
                  </div>
                  <div class="contact-details">
                    <h4 class="heading-6">Email Us</h4>
                    <p class="text-muted">
                      General:{' '}
                      <>
                        <a href="mailto:hello@company.com" class="link">
                          hello@company.com
                        </a>
                        <br />
                      </>
                      Support:{' '}
                      <a href="mailto:support@company.com" class="link">
                        support@company.com
                      </a>
                    </p>
                  </div>
                </div>
              </Card>

              <Card>
                <h4 class="heading-6 mb-4">Business Hours</h4>
                <div class="business-hours space-y-2">
                  <div class="flex justify-between">
                    <span class="text-muted">Monday - Friday</span>
                    <span class="font-medium">9:00 AM - 6:00 PM EST</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-muted">Saturday</span>
                    <span class="font-medium">10:00 AM - 4:00 PM EST</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-muted">Sunday</span>
                    <span class="font-medium">Closed</span>
                  </div>
                </div>
              </Card>

              <Card>
                <h4 class="heading-6 mb-4">Response Time</h4>
                <div class="response-times space-y-3">
                  <div class="flex items-center gap-3">
                    <Icon name="check" size="sm" color="success" />
                    <span class="text-small">
                      Email inquiries: Within 2 hours
                    </span>
                  </div>
                  <div class="flex items-center gap-3">
                    <Icon name="check" size="sm" color="success" />
                    <span class="text-small">Phone calls: Immediately</span>
                  </div>
                  <div class="flex items-center gap-3">
                    <Icon name="check" size="sm" color="success" />
                    <span class="text-small">
                      Project proposals: Within 24 hours
                    </span>
                  </div>
                </div>
              </Card>
            </div>
          </Animate>
        )
      }
    </div>
  </div>
</section>

<script>
  // Import the enhanced contact form script that uses our utilities
  import '../scripts/contact-form';
</script>

<style>
  .contact-form {
    /*
      When the mobile keyboard is open, VisualViewport can reduce usable height.
      We expose a CSS var so scripts can give the page extra scroll slack.
    */
    padding-bottom: calc(
      var(--keyboard-offset, 0px) + env(safe-area-inset-bottom, 0px)
    );
  }

  .contact-form :is(input, textarea, select) {
    scroll-margin-top: 6rem;
    scroll-margin-bottom: calc(var(--keyboard-offset, 0px) + 2rem);
  }

  .contact-section {
    background: linear-gradient(135deg, var(--color-gray-50) 0%, white 100%);
  }

  .contact-grid {
    align-items: start;
  }

  .contact-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
  }

  .contact-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(
      135deg,
      var(--color-primary-600),
      var(--color-primary-800)
    );
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .form-checkbox {
    width: 1rem;
    height: 1rem;
    border: 2px solid var(--color-gray-300);
    border-radius: var(--radius-sm);
    background: white;
    cursor: pointer;
  }

  .form-checkbox:checked {
    background: var(--color-primary-600);
    border-color: var(--color-primary-600);
  }

  .form-input.error,
  .form-textarea.error,
  .form-select.error {
    border-color: #ef4444;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
  }

  .business-hours > div,
  .response-times > div {
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--color-gray-100);
  }

  .business-hours > div:last-child,
  .response-times > div:last-child {
    border-bottom: none;
  }

  @media (max-width: 768px) {
    .form-grid {
      grid-template-columns: 1fr;
    }

    .contact-grid {
      grid-template-columns: 1fr;
      gap: 2rem;
    }
  }
</style>
